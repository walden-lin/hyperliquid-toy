# 📊 事件驱动资金费率回测工具

一个基于 Hyperliquid 数据的事件驱动资金费率回测和可视化系统，用于分析重大事件对加密货币资金费率的影响。

## 🚀 功能特性

- **事件驱动回测**: 基于历史重大事件进行资金费率策略回测
- **异常检测**: 使用 Z-score 算法检测资金费率异常
- **多币种支持**: 支持 BTC、ETH、SOL、BNB 等主流币种
- **交互式可视化**: 使用 Plotly 提供丰富的图表展示
- **策略参数调优**: 可调整滚动窗口、阈值等策略参数
- **交易记录导出**: 支持 CSV 格式导出交易记录

## 🏗️ 项目结构

```
funding-backtester/
├── app.py                # Streamlit 主应用
├── data.py               # 数据获取模块
├── strategy.py           # 策略和回测逻辑
├── visualization.py      # 可视化模块
├── events.json           # 事件配置文件
├── requirements.txt      # 依赖包列表
└── README.md            # 项目说明
```

## 🛠️ 安装和运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行应用

```bash
streamlit run app.py
```

### 3. 访问应用

浏览器会自动打开 `http://localhost:8501`

## 📊 核心算法

### 异常检测算法

使用 Z-score 方法检测资金费率异常：

```
z = (fundingRate - mean) / std
```

- `z > +2`: SHORT 信号（资金费率过高）
- `z < -2`: LONG 信号（资金费率过低）
- `-2 ≤ z ≤ +2`: HOLD 信号（正常范围）

### 回测逻辑

1. **开仓条件**: 当 Z-score 超过阈值时开仓
2. **持仓管理**: 持有至信号恢复正常或资金费率结算
3. **盈亏计算**: 资金费率收入 ± 价格变动
4. **风险控制**: 使用固定比例资金开仓

## 📈 事件配置

事件配置文件 `events.json` 包含以下字段：

```json
{
  "name": "事件名称",
  "coin": "币种符号",
  "timestamp": "事件时间 (ISO格式)",
  "description": "事件描述",
  "category": "事件类别",
  "impact": "影响程度"
}
```

### 支持的事件类别

- `upgrade`: 技术升级
- `regulatory`: 监管事件
- `market_crash`: 市场崩盘
- `milestone`: 里程碑事件
- `outage`: 网络中断
- `launch`: 产品发布

### 影响程度等级

- `very_high`: 极高影响
- `high`: 高影响
- `medium`: 中等影响
- `low`: 低影响

## 🎯 使用指南

### 1. 选择事件

从侧边栏下拉菜单选择要分析的重大事件。

### 2. 调整策略参数

- **滚动窗口**: 用于计算 Z-score 的时间窗口
- **Z-score 阈值**: 触发交易信号的阈值
- **初始资金**: 回测的起始资金

### 3. 查看回测结果

- **关键指标**: 总收益、胜率、夏普比率等
- **可视化图表**: 资金费率走势、交易信号、组合表现
- **交易记录**: 详细的交易历史记录

### 4. 分析事件影响

- **事件前后对比**: 分析事件对资金费率的影响
- **信号分布**: 查看异常信号的分布情况
- **相关性分析**: 分析交易指标间的相关性

## 📊 可视化功能

### 1. 资金费率走势图

- 显示资金费率时间序列
- 标记交易信号点
- 显示滚动均值和置信区间
- 突出显示事件时间点

### 2. 价格走势图

- 显示价格变化趋势
- 标记事件时间点
- 支持缩放和悬停查看

### 3. 组合表现图

- 显示组合价值变化
- 计算累计收益
- 标记初始资金线

### 4. 交易时间线

- 显示所有交易的时间分布
- 用颜色区分盈亏
- 显示交易持续时间

### 5. 相关性热力图

- 分析交易指标间的相关性
- 使用颜色深浅表示相关强度
- 支持数值显示

## 🔧 技术架构

### 数据层

- **Hyperliquid API**: 获取资金费率历史数据
- **数据缓存**: 使用 Streamlit 缓存提高性能
- **容错处理**: 支持模拟数据作为备选

### 策略层

- **异常检测**: 基于统计学的 Z-score 方法
- **信号生成**: 自动生成交易信号
- **回测引擎**: 完整的回测框架

### 可视化层

- **Plotly**: 交互式图表库
- **Streamlit**: Web 应用框架
- **响应式设计**: 适配不同屏幕尺寸

## 📈 回测指标

### 收益指标

- **总收益**: 绝对收益金额
- **总收益率**: 相对收益率
- **年化收益率**: 年化后的收益率

### 风险指标

- **最大回撤**: 最大亏损幅度
- **夏普比率**: 风险调整后收益
- **波动率**: 收益的波动程度

### 交易指标

- **总交易数**: 完成的交易次数
- **胜率**: 盈利交易占比
- **平均交易盈亏**: 单笔交易平均收益

## ⚠️ 风险提示

1. **教育目的**: 本工具仅用于教育和研究目的
2. **历史数据**: 历史回测结果不代表未来表现
3. **交易成本**: 实际交易存在滑点、手续费等成本
4. **市场风险**: 加密货币市场存在高风险
5. **投资建议**: 不构成任何投资建议

## 🔮 未来扩展

### 功能扩展

- [ ] 支持更多交易所数据
- [ ] 添加机器学习预测模型
- [ ] 实现实时数据更新
- [ ] 添加更多技术指标

### 技术优化

- [ ] 数据库持久化存储
- [ ] 分布式计算支持
- [ ] API 接口封装
- [ ] 容器化部署

### 用户体验

- [ ] 移动端适配
- [ ] 多语言支持
- [ ] 主题切换
- [ ] 个性化设置

## 📝 更新日志

### v1.0.0 (2024-09-20)

- ✅ 初始版本发布
- ✅ 支持事件驱动回测
- ✅ 实现异常检测算法
- ✅ 提供完整的可视化功能
- ✅ 支持多币种分析

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📄 许可证

MIT License

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- GitHub Issues: [项目地址]
- Email: [联系邮箱]

---

**免责声明**: 本工具仅供教育和研究使用，不构成投资建议。使用本工具进行任何投资决策的风险由用户自行承担。
